{% extends "admin/base_site.html" %}

{% load static %}
{% load admin_tags %}
{% load admin_urls %}

{% block title %}Payment report | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block content %}
<style>
table, th, td {
    border: 1px solid black;
    border-collapse: collapse;
}
table{
    width: 100%;
}
th, td {
    padding: 5px;
    text-align: left;
}
br {
    padding: 5px;
}
</style>

    {% for pair_report in payment_report.pair_reports %}
    <table>
    <caption>Pair report {{ forloop.counter }}</caption>
        <tr>
            <th>Provider:</th>
            <td colspan="2">
                {% for address in  pair_report.provider_ethereum_addresses %}
                    <a href="https://{{ eth_network }}etherscan.io/address/{{ address }}">{{ address }}</a>,
                {% endfor %}
                public key: {{ pair_report.provider.public_key }}
            </td>
        </tr>
        <tr>
            <th>Requestor:</th>
            <td colspan="2">
                {% for address in  pair_report.requestor_ethereum_addresses %}
                    <a href="https://{{ eth_network }}etherscan.io/address/{{ address }}">{{ address }}</a>,
                {% endfor %}
                public key: {{ pair_report.requestor.public_key }}
            </td>
        </tr>

        {#  Pending Responses table  #}
        <tr>
            <th rowspan="3">PendingResponses</th>
            <th>SubtaskResultsSettled</th>
            <td>
            {% for subtask_results_settled in pair_report.pending_responses.subtask_results_settled %}
                <p><a href="{% url 'admin:core_pendingresponse_change' subtask_results_settled.id %}">
                - subtask_id: {{ subtask_results_settled.subtask.subtask_id }},
                delivered: {{ subtask_results_settled.delivered }},
                created_at: {{ subtask_results_settled.created_at }}</a>
                </p>
            {% endfor %}
            </td>
        </tr>
        <tr>
            <th>SubtaskResultsRejected</th>
            <td>
            {% for subtask_results_rejected in pair_report.pending_responses.subtask_results_rejected %}
                <p><a href="{% url 'admin:core_pendingresponse_change' subtask_results_rejected.id %}">
                    - subtask_id: {{ subtask_results_rejected.subtask.subtask_id }},
                    delivered: {{ subtask_results_rejected.delivered }},
                    created_at: {{ subtask_results_rejected.created_at }}</a>
                </p>
            {% endfor %}
            </td>
        </tr>
        <tr>
            <th>ForcePaymentCommitted</th>
            <td>
            {% for force_payment_committed in pair_report.pending_responses.force_payment_committed %}
                <p><a href="{% url 'admin:core_pendingresponse_change' force_payment_committed.id %}">
                    - delivered: {{ force_payment_committed.delivered }},
                    created_at: {{ force_payment_committed.created_at }}</a>
                </p>
            {% endfor %}
            </td>
        </tr>

        {#  Payments table  #}
        <tr>
            <th rowspan="5">Payments</th>
            <th>Regular payments</th>
            <td>
            {% for payment in pair_report.payments.regular_payments %}
                <p>
                    <a href="https://{{ eth_network }}etherscan.io/address/{{ payment.provider }}">- provider: {{ payment.provider }}</a>,
                    <a href="https://{{ eth_network }}etherscan.io/address/{{ payment.requestor }}">requestor: {{ payment.requestor }}</a>,
                    amount: {{ payment.amount }},
                    <a href="https://{{ eth_network }}etherscan.io/tx/{{ payment.tx_hash }}">tx_hash: {{ payment.tx_hash }}</a>
                </p>
            {% endfor %}
            </td>
        </tr>
        <tr>
            <th>settlement_payments</th>
            <td>
            {% for payment in pair_report.payments.settlement_payments %}
                <p>
                    <a href="https://{{ eth_network }}etherscan.io/address/{{ payment.provider }}">- provider: {{ payment.provider }}</a>,
                    <a href="https://{{ eth_network }}etherscan.io/address/{{ payment.requestor }}">requestor: {{ payment.requestor }}</a>,
                    amount: {{ payment.amount }},
                    <a href="https://{{ eth_network }}etherscan.io/tx/{{ payment.tx_hash }}">tx_hash: {{ payment.tx_hash }}</a>
                </p>
            {% endfor %}
            </td>
        </tr>
        <tr>
            <th>forced_subtask_payments</th>
            <td>
            {% for payment in pair_report.payments.forced_subtask_payments %}
                <p>
                    <a href="https://{{ eth_network }}etherscan.io/address/{{ payment.provider }}">- provider: {{ payment.provider }}</a>,
                    <a href="https://{{ eth_network }}etherscan.io/address/{{ payment.requestor }}">requestor: {{ payment.requestor }}</a>,
                    amount: {{ payment.amount }},
                    <a href="https://{{ eth_network }}etherscan.io/tx/{{ payment.tx_hash }}">tx_hash: {{ payment.tx_hash }}</a>
                </p>
            {% endfor %}
            </td>
        </tr>
        <tr>
            <th>requestor_additional_verification_payments</th>
            <td>
            {% for payment in pair_report.payments.additional_verification_payments_for_requestor %}
                <p>
                - subtask_id: {{ payment.subtask_id }},
                <a href="https://{{ eth_network }}etherscan.io/address/{{ payment.address }}">address: {{ payment.address }}</a>,
                amount: {{ payment.amount }},
                <a href="https://{{ eth_network }}etherscan.io/tx/{{ payment.tx_hash }}">tx_hash: {{ payment.tx_hash }}</a>
                </p>
            {% endfor %}
            </td>
        </tr>
        <tr>
            <th>provider_additional_verification_payments</th>
            <td>
            {% for payment in pair_report.payments.additional_verification_payments_for_provider %}
                <p>
                - subtask_id: {{ payment.subtask_id }},
                <a href="https://{{ eth_network }}etherscan.io/address/{{ payment.address }}">address: {{ payment.address }}</a>,
                amount: {{ payment.amount }},
                <a href="https://{{ eth_network }}etherscan.io/tx/{{ payment.tx_hash }}">tx_hash: {{ payment.tx_hash }}</a>
                </p>
            {% endfor %}
            </td>
        </tr>
    </table>
    <br>
    {% endfor %}

{% endblock %}
